{% extends 'base.html.twig' %}

{% block title %}Figure:{% endblock %}

{% block body %}
 <!-- Start Trick -->
    <div class="container mt-5">  
        <div class="row justify-content-center mt-5">          
            <div class="col-md-10 col-md-offset-1 mt-5 mb-4"> 
                 <div class="card mt-5">
                    <img class="card-img-top" src="/uploads/{{ trick.image }}" alt="{{ trick.title }}-main">
                    <div class="card-body">
                         <ul class="list-inline trick-data">
                            <li class="list-inline-item">
                                Par :
                            </li> |           
                            <li class="list-inline-item">
                                Ajouté le {{ trick.createdAt | date('d/m/Y') }} (<small>Mise à jour le : {% if trick.updatedAt is defined %}{{ trick.updatedAt | date('d/m/Y') }}{% endif %}</small>)
                            </li> |                            
                            <li class="list-inline-item">
                                Catégorie : {{ trick.category.title }}
                            </li> |
                            <li class="list-inline-item">
                                <a href="#comments-block">{{ trick.comments | length }} commentaires</a>
                            </li>
                        </ul>
                        <hr>
                        <h4 class="card-title"><strong>{{ trick.title }}</strong></h4>
                        <hr>

                         <!-- Start Carousel -->
                        {% if (trick.videos) %}
                            <div class="row d-none d-lg-flex load-media">
                                                                 
                                <div class="col-lg-6 col-md-12">
                                    <div id="carousel-v" class="carousel slide mt-3 mb-2" data-ride="carousel">
                                        <ol class="carousel-indicators">
                                            {% for video in videos %}
                                                <li data-target="#carousel-v" data-slide-to="{{ loop.index0 }}" {% if loop.index0 == 0 %} class="active" {% endif %}></li>
                                            
                                            {% endfor %}
                                        </ol>
                                        <div class="carousel-inner">
                                            {% for video in videos %}
                                                <div class="carousel-item {% if loop.index0 == 0 %} active {% endif %}">
                                                    <iframe src="{{ video.url }}" allowfullscreen></iframe>
                                                </div>
                                            {% endfor %}        
                                        </div>
                                        <a class="carousel-control-prev" href="#carousel-v" data-slide="prev">
                                            <span class="carousel-control-prev-icon"></span>
                                        </a>
                                        <a class="carousel-control-next" href="#carousel-v" data-slide="next">
                                            <span class="carousel-control-next-icon"></span>
                                        </a> 
                                    </div>
                                </div>                                                  
                            </div>                      
                            <div class="text-center">
                                <a href="#" id="loadMedia" class="d-md-block d-lg-none">
                                    <button class="btn btn-outline-secondary">Afficher les médias</button>
                                </a>
                                <a href="#" id="hideMedia" class="d-none d-md-none d-lg-none">
                                    <button class="btn btn-outline-secondary mt-3">Masquer les médias</button>
                                </a>
                            </div>
                        {% else %}
                            <div class="row justify-content-center">
                                <div class="d-inline-block text-center no-medias">
                                    <p class="mt-3 ml-3 mr-3">Pas de médias pour ce trick</p>
                                </div>
                            </div>                           
                        {% endif %}
                        <!-- End Carousel -->
                        <hr>
                        <h5 class="card-title">Description</h5>
                        <p class="card-text text-justify">{{ trick.content }}</p>                                    
                    </div>
                </div>
                <!--  End Trick -->
            
            
            
            <h2>Figure: {{trick.title}} </h2>
             <div>
                <img src="{{ asset('/uploads/' ~ trick.image) }}" alt="Image" width="150">
            <div class="metadata">Ecrit le {{trick.createdAt| date('d/m/Y')}} à {{trick.createdAt| date('H:i')}}dans la catégolie {{trick.category.title}}</div>
                <div class="content">
                <p>{{ trick.content | raw }}</p>
                <hr>

            </div>
        </trick>
        
          {% if trick.images | length != 0 %}
        <h2>Images</h2>
        {% endif %} 
        {% for image in trick.images %}
            <div>
                <img src="{{ asset('/uploads/' ~ image.name) }}" alt="Image" width="150">
               {% if app.user %}
                <a href="{{ path('trick_delete_image', {id: image.id}) }}" data-delete data-token="{{ csrf_token('delete' ~ image.id) }}">Supprimer</a>
             {% endif %} </hr>
            </div>
        {% endfor %}
        {% if trick.videos | length != 0 %}
        <h2>Videos:</h2>
         {% endif %}
        {% for video in trick.videos %}
            <div>
               <li data-target="#carousel-v" data-slide-to="{{ loop.index0 }}" {% if loop.index0 == 0 %} class="active" {% endif %}></li>
             <div class="carousel-item {% if loop.index0 == 0 %} active {% endif %}">
                                                    <iframe src="{{ video.url }}" allowfullscreen></iframe>
                                                </div>
             {% if app.user %}
                <a href="{{ path('trick_delete_image', {id: image.id}) }}" data-delete data-token="{{ csrf_token('delete' ~ video.id) }}">Supprimer</a>
             {% endif %} </hr>
            </div>
        {% endfor %}
   
        <section id="commentaires">
            {% if app.user %}

                <form method="POST">
                 {{form_start(commentForm)}}
                 {{form_row(commentForm.author, {'attr': {'placeholder': "votre nom"}})}}
                 {{form_row(commentForm.content, {'attr': {'placeholder': "votre commentaire"}})}}
         
                <button type="submit" class="btn-success">Commenter! </button>
                {{form_end(commentForm)}}
                </form>
            {% else %}
                <h2> Vous ne pouvez pas commenter si vous n'êtes pas connectés!</h2>
                <a href="{{path('security_login')}}" class="btn btn-primary"> Connexion </a>
            {% endif %} </hr>
            {% if trick.comments | length != 0  %}
                <h1> {{trick.comments | length }} commentaires : </h1>
            {% endif %} </hr>
            {% for comment in trick.comments %}
                <div class="comment">
                    <div class="row">
                        <div class="col3">
                             {{comment.author}} (<small>{{comment.createdAt | date('d/m/y à H:i')}}</small>)
                        </div>
                        <div class="col">
                              {{comment.content | raw}}
                        </div>
                    </div>
                 </div>
            {% endfor %}
    </div>
    </div>
    </div>
{% endblock %}
{% block javascripts %}
    <script src="{{ asset('js/images.js') }}"></script>
{% endblock %}
