{% extends 'base.html.twig' %}

{% block title %}Figure:{% endblock %}

{% block body %}
<section class="trick">
       <section class="trick">
            <h2>Figure: {{trick.title}} </h2>
            <div class="metadata">Ecrit le {{trick.createdAt| date('d/m/Y')}} à {{trick.createdAt| date('H:i')}}dans la catégolie {{trick.category.title}}</div>
                <div class="content">
                <p>{{ trick.content | raw }}</p>
                <hr>

            </div>
        </trick>
        
          {% if trick.images | length != 0 %}
        <h2>Images</h2>
        {% endif %} 
        {% for image in trick.images %}
            <div>
                <img src="{{ asset('/uploads/' ~ image.name) }}" alt="Image" width="150">
               {% if app.user %}
                <a href="{{ path('trick_delete_image', {id: image.id}) }}" data-delete data-token="{{ csrf_token('delete' ~ image.id) }}">Supprimer</a>
             {% endif %} </hr>
            </div>
        {% endfor %}
        {% if trick.videos | length != 0 %}
        <h2>Videos:</h2>
         {% endif %}
        {% for video in trick.videos %}
            <div>
               <li data-target="#carousel-v" data-slide-to="{{ loop.index0 }}" {% if loop.index0 == 0 %} class="active" {% endif %}></li>
             <div class="carousel-item {% if loop.index0 == 0 %} active {% endif %}">
                                                    <iframe src="{{ video.url }}" allowfullscreen></iframe>
                                                </div>
             {% if app.user %}
                <a href="{{ path('trick_delete_image', {id: image.id}) }}" data-delete data-token="{{ csrf_token('delete' ~ video.id) }}">Supprimer</a>
             {% endif %} </hr>
            </div>
        {% endfor %}
   
<section id="commentaires">
   {% if app.user %}

     <form method="POST">
        {{form_start(commentForm)}}
        {{form_row(commentForm.author, {'attr': {'placeholder': "votre nom"}})}}
        {{form_row(commentForm.content, {'attr': {'placeholder': "votre commentaire"}})}}
         
        <button type="submit" class="btn-success">Commenter! </button>
        {{form_end(commentForm)}}
     </form>
    {% else %}
    <h2> Vous ne pouvez pas commenter si vous n'êtes pas connectés!</h2>
    <a href="{{path('security_login')}}" class="btn btn-primary"> Connexion </a>
    {% endif %} </hr>
   {% if trick.comments | length != 0  %}
   <h1> {{trick.comments | length }} commentaires : </h1>
     {% endif %} </hr>
    {% for comment in trick.comments %}
     <div class="comment">
        <div class="row">
            <div class="col3">
                {{comment.author}} (<small>{{comment.createdAt | date('d/m/y à H:i')}}</small>)
            </div>
            <div class="col">
                {{comment.content | raw}}
            </div>
        </div>
    </div>
    {% endfor %}
    
{% endblock %}
{% block javascripts %}
    <script src="{{ asset('js/images.js') }}"></script>
{% endblock %}
